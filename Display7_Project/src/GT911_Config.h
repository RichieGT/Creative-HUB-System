#ifndef GT911_CONFIG_H
#define GT911_CONFIG_H

#include <Arduino.h>
#include <Wire.h>

#define GT911_ADDR_CONFIG 0x14

// Configuration for 800x480
// Start Register: 0x8047
// Checksum is calculated automatically by the function.
const uint8_t GT911_Config_800x480[] = {
    0x61, // 0x8047: Config Version (Bumped to 0x61 - High Sensitivity)
    0x03, // 0x8048: X Output Max High Byte (0x0320 = 800)
    0x20, // 0x8049: X Output Max Low Byte
    0x01, // 0x804A: Y Output Max High Byte (0x01E0 = 480)
    0xE0, // 0x804B: Y Output Max Low Byte
    0x00, // 0x804C: Touch Number (0 = 5 fingers)
    0x05, // 0x804D: Module Switch 1
    0x20, // 0x804E: Module Switch 2
    0x05, // 0x804F: Shake Count
    0x08, // 0x8050: Filter
    0x32, // 0x8051: Large Touch
    0x05, // 0x8052: Noise Reduction
    0x20, // 0x8053: Screen Touch Level (Lowered to 0x20)
    0x3C, // 0x8054: Screen Leave Level
    0x0F, // 0x8055: Low Power Control
    0x05, // 0x8056: Refresh Rate
    0x00, // 0x8057: X Threshold
    0x00, // 0x8058: Y Threshold
    0xFF, // 0x8059: Space (Reserved)
    0x67, // 0x805A: Space (Reserved)
    0x20, // 0x805B: Mini Filter (Lowered to 0x20)
    0x00, // 0x805C: Space
    0x00, // 0x805D: Space
    0x18, // 0x805E: Space
    0x1A, // 0x805F: Space
    0x1E, // 0x8060: Space
    0x14, // 0x8061: Space
    0x89, // 0x8062: Space
    0x28, // 0x8063: Space
    0x0A, // 0x8064: Space
    0x30, // 0x8065: Space
    0x2E, // 0x8066: Space
    0xBB, // 0x8067: Space
    0x0A, // 0x8068: Space
    0x03, // 0x8069: Space
    0x00, // 0x806A: Space
    0x00, // 0x806B: Space
    0x02, // 0x806C: Space
    0x33, // 0x806D: Space
    0x1D, // 0x806E: Space
    0x00, // 0x806F: Space
    0x00, // 0x8070: Space
    0x00, // 0x8071: Space
    0x00, // 0x8072: Space
    0x00, // 0x8073: Space
    0x00, // 0x8074: Space
    0x00, // 0x8075: Space
    0xAA, // 0x8076: Space
    0x29, // 0x8077: Space
    0x0A, // 0x8078: Space
    0x1E, // 0x8079: Space
    0x1E, // 0x807A: Space
    0x08, // 0x807B: Space
    0x04, // 0x807C: Space
    0x00, // 0x807D: Space
    0x1E, // 0x807E: Space
    0x19, // 0x807F: Space
    0x05, // 0x8080: Space
    0x00, // 0x8081: Space
    0x00, // 0x8082: Space
    0x00, // 0x8083: Space
    0x00, // 0x8084: Space
    0x00, // 0x8085: Space
    0x00, // 0x8086: Space
    0x00, // 0x8087: Space
    0x00, // 0x8088: Space
    0x00, // 0x8089: Space
    0x00, // 0x808A: Space
    0x00, // 0x808B: Space
    0x00, // 0x808C: Space
    0x00, // 0x808D: Space
    0x00, // 0x808E: Space
    0x00, // 0x808F: Space
    0x00, // 0x8090: Space
    0x00, // 0x8091: Space
    0x00, // 0x8092: Space
    0x00, // 0x8093: Space
    0x00, // 0x8094: Space
    0x00, // 0x8095: Space
    0x00, // 0x8096: Space
    0x00, // 0x8097: Space
    0x00, // 0x8098: Space
    0x00, // 0x8099: Space
    0x00, // 0x809A: Space
    0x00, // 0x809B: Space
    0x00, // 0x809C: Space
    0x00, // 0x809D: Space
    0x00, // 0x809E: Space
    0x00, // 0x809F: Space
    0x00, // 0x80A0: Space
    0x00, // 0x80A1: Space
    0x00, // 0x80A2: Space
    0x00, // 0x80A3: Space
    0x00, // 0x80A4: Space
    0x00, // 0x80A5: Space
    0x00, // 0x80A6: Space
    0x00, // 0x80A7: Space
    0x00, // 0x80A8: Space
    0x00, // 0x80A9: Space
    0x00, // 0x80AA: Space
    0x00, // 0x80AB: Space
    0x00, // 0x80AC: Space
    0x00, // 0x80AD: Space
    0x00, // 0x80AE: Space
    0x00, // 0x80AF: Space
    0x00, // 0x80B0: Space
    0x00, // 0x80B1: Space
    0x00, // 0x80B2: Space
    0x00, // 0x80B3: Space
    0x00, // 0x80B4: Space
    0x00, // 0x80B5: Space
    0x00, // 0x80B6: Space
    0x00, // 0x80B7: Space
    0x00, // 0x80B8: Space
    0x00, // 0x80B9: Space
    0x00, // 0x80BA: Space
    0x00, // 0x80BB: Space
    0x00, // 0x80BC: Space
    0x00, // 0x80BD: Space
    0x00, // 0x80BE: Space
    0x00, // 0x80BF: Space
    0x00, // 0x80C0: Space
    0x00, // 0x80C1: Space
    0x00, // 0x80C2: Space
    0x00, // 0x80C3: Space
    0x00, // 0x80C4: Space
    0x00, // 0x80C5: Space
    0x00, // 0x80C6: Space
    0x00, // 0x80C7: Space
    0x00, // 0x80C8: Space
    0x00, // 0x80C9: Space
    0x00, // 0x80CA: Space
    0x00, // 0x80CB: Space
    0x00, // 0x80CC: Space
    0x00, // 0x80CD: Space
    0x00, // 0x80CE: Space
    0x00, // 0x80CF: Space
    0x00, // 0x80D0: Space
    0x00, // 0x80D1: Space
    0x00, // 0x80D2: Space
    0x00, // 0x80D3: Space
    0x00, // 0x80D4: Space
    0x00, // 0x80D5: Space
    0x00, // 0x80D6: Space
    0x00, // 0x80D7: Space
    0x00, // 0x80D8: Space
    0x00, // 0x80D9: Space
    0x00, // 0x80DA: Space
    0x00, // 0x80DB: Space
    0x00, // 0x80DC: Space
    0x00, // 0x80DD: Space
    0x00, // 0x80DE: Space
    0x00, // 0x80DF: Space
    0x00, // 0x80E0: Space
    0x00, // 0x80E1: Space
    0x00, // 0x80E2: Space
    0x00, // 0x80E3: Space
    0x00, // 0x80E4: Space
    0x00, // 0x80E5: Space
    0x00, // 0x80E6: Space
    0x00, // 0x80E7: Space
    0x00, // 0x80E8: Space
    0x00, // 0x80E9: Space
    0x00, // 0x80EA: Space
    0x00, // 0x80EB: Space
    0x00, // 0x80EC: Space
    0x00, // 0x80ED: Space
    0x00, // 0x80EE: Space
    0x00, // 0x80EF: Space
    0x00, // 0x80F0: Space
    0x00, // 0x80F1: Space
    0x00, // 0x80F2: Space
    0x00, // 0x80F3: Space
    0x00, // 0x80F4: Space
    0x00, // 0x80F5: Space
    0x00, // 0x80F6: Space
    0x00, // 0x80F7: Space
    0x00, // 0x80F8: Space
    0x00, // 0x80F9: Space
    0x00, // 0x80FA: Space
    0x00, // 0x80FB: Space
    0x00, // 0x80FC: Space
    0x00, // 0x80FD: Space
    0x00  // 0x80FE: Space
};

void configureGT911() {
    Serial.println("Configuring GT911...");
    
    // 1. Prepare Buffer: Register Address (2 bytes) + Config Data + Checksum (1 byte) + Enable (1 byte)
    // 0x8047 is start. Total Size = sizeof(GT911_Config_800x480) + 2 (checksum + enable).
    // The checksum is (0 - sum(config)) & 0xFF.
    // The enable byte is 0x01.
    
    uint16_t configSize = sizeof(GT911_Config_800x480);
    uint8_t checksum = 0;
    
    for (int i=0; i<configSize; i++) {
        checksum += GT911_Config_800x480[i];
    }
    checksum = (~checksum) + 1; // Two's complement or just 0-sum? Datasheet says: checksum = (~sum) + 1
    
    // Write Configuration
    Wire.beginTransmission(GT911_ADDR_CONFIG);
    Wire.write(0x80); // High Byte of Register
    Wire.write(0x47); // Low Byte of Register
    
    for (int i=0; i<configSize; i++) {
        Wire.write(GT911_Config_800x480[i]);
    }
    
    Wire.write(checksum);
    Wire.write(0x01); // Config Update Flag
    
    if (Wire.endTransmission() == 0) {
        Serial.println("GT911 Config Sent!");
    } else {
        Serial.println("GT911 Config Failed!");
    }
    
    delay(100); // Wait for flash
}

#endif
